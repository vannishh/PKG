<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Viewer: Cyberpunk Edition (Lab 6 - Letter K)</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.2.1/math.js"></script>

    <style>
        :root {
            --bg-main: #0B0C10; /* –ì–ª—É–±–æ–∫–∏–π —á–µ—Ä–Ω—ã–π/—Å–∏–Ω–∏–π */
            --bg-panel: #1F2833; /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π –¥–ª—è –ø–∞–Ω–µ–ª–∏ */
            --text-main: #C5C6C7; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç */
            --accent: #00da49; /* –ù–µ–æ–Ω–æ–≤—ã–π —Ü–∏–∞–Ω (–∞–∫—Ü–µ–Ω—Ç) */
            --accent-dim: #006321; /* –¢—É—Å–∫–ª—ã–π —Ü–∏–∞–Ω (–≥—Ä–∞–Ω–∏—Ü—ã) */
            --btn-bg: #2C3E50; /* –§–æ–Ω –∫–Ω–æ–ø–æ–∫ */
            --btn-hover: #008111; /* –•–æ–≤–µ—Ä –∫–Ω–æ–ø–æ–∫ */

            --line-3d: #019215; /* –¶–≤–µ—Ç –ª–∏–Ω–∏–π –º–æ–¥–µ–ª–∏ */
            --vertex-3d: #FF0055; /* –¶–≤–µ—Ç —Ç–æ—á–µ–∫ (—è—Ä–∫–∞—è –º–∞–¥–∂–µ–Ω—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞) */
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* –õ–ï–í–ê–Ø –ß–ê–°–¢–¨ (–ì–†–ê–§–ò–ö) */
        .plot-area {
            flex: 1;
            background-color: var(--bg-main);
            position: relative;
            min-width: 0;
        }

        /* –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ (–ü–ê–ù–ï–õ–¨) */
        .control-panel {
            width: 360px;
            background-color: var(--bg-panel);
            padding: 25px;
            overflow-y: auto;
            height: 100%;
            box-sizing: border-box;
            border-left: 2px solid var(--accent-dim);
            box-shadow: -5px 0 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

            /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
            .control-panel::-webkit-scrollbar {
                width: 8px;
            }

            .control-panel::-webkit-scrollbar-track {
                background: var(--bg-main);
            }

            .control-panel::-webkit-scrollbar-thumb {
                background: var(--accent-dim);
                border-radius: 4px;
            }

                .control-panel::-webkit-scrollbar-thumb:hover {
                    background: var(--accent);
                }

        h3 {
            margin: 0 0 10px 0;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
            font-size: 1.2rem;
            border-bottom: 1px solid var(--accent-dim);
            padding-bottom: 10px;
        }

        .control-group {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid rgba(102, 252, 241, 0.1);
            transition: border-color 0.3s;
        }

            .control-group:hover {
                border-color: var(--accent-dim);
            }

        label {
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #fff;
        }

        .input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            background-color: var(--bg-main);
            border: 1px solid var(--accent-dim);
            color: var(--accent);
            border-radius: 4px;
            text-align: center;
            font-family: monospace;
            font-weight: bold;
        }

            input[type="number"]:focus {
                outline: none;
                border-color: var(--accent);
                box-shadow: 0 0 5px var(--accent);
            }

        button {
            width: 100%;
            padding: 10px;
            background-color: var(--btn-bg);
            color: #fff;
            border: 1px solid var(--accent-dim);
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

            button:hover {
                background-color: var(--btn-hover);
                color: #000;
                box-shadow: 0 0 10px var(--accent-dim);
            }

        hr {
            border: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-dim), transparent);
            margin: 15px 0;
        }

        /* –ú–ê–¢–†–ò–¶–ê - –°—Ç–∏–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ */
        textarea {
            width: 100%;
            height: 120px !important;
            min-height: 200px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: vertical;
            border: 1px solid var(--accent-dim);
            border-radius: 4px;
            background: #000; /* –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –∫–æ–¥–∞ */
            color: var(--accent); /* –ù–µ–æ–Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç */
            padding: 10px;
            box-sizing: border-box;
            white-space: pre;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--bg-panel);
            padding: 20px;
            border: 2px solid var(--accent);
            border-radius: 10px;
            width: 90%;
            height: 90%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(102, 252, 241, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

            .modal-header h2 {
                color: var(--accent);
                font-size: 1.5rem;
            }

        .close-btn {
            width: auto;
            background: var(--vertex-3d);
            border: none;
            color: white;
            padding: 5px 20px;
        }

            .close-btn:hover {
                background: #ff4d88;
                box-shadow: 0 0 10px #ff4d88;
            }

        .projections-grid {
            display: flex;
            flex: 1;
            gap: 15px;
        }

        .proj-plot {
            flex: 1;
            background: var(--bg-main);
            border: 1px solid var(--accent-dim);
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- –ì–†–ê–§–ò–ö -->
        <div id="plot3d" class="plot-area"></div>

        <!-- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
        <div class="control-panel">
            <h3>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è 6: –ë—É–∫–≤–∞ "–ö"</h3>

            <div class="control-group">
                <label>–í—Ä–∞—â–µ–Ω–∏–µ X (¬∞):</label>
                <div class="input-row"><input type="number" id="rotX" value="0"></div>
                <button onclick="applyRotation('x')">–í—Ä–∞—â–∞—Ç—å X</button>
            </div>

            <div class="control-group">
                <label>–í—Ä–∞—â–µ–Ω–∏–µ Y (¬∞):</label>
                <div class="input-row"><input type="number" id="rotY" value="0"></div>
                <button onclick="applyRotation('y')">–í—Ä–∞—â–∞—Ç—å Y</button>
            </div>

            <div class="control-group">
                <label>–í—Ä–∞—â–µ–Ω–∏–µ Z (¬∞):</label>
                <div class="input-row"><input type="number" id="rotZ" value="0"></div>
                <button onclick="applyRotation('z')">–í—Ä–∞—â–∞—Ç—å Z</button>
            </div>

            <div class="control-group">
                <label>–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:</label>
                <div class="input-row"><input type="number" id="scaleVal" value="1" step="0.1"></div>
                <button onclick="applyScale()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>

            <div class="control-group">
                <label>–°–¥–≤–∏–≥ (X, Y, Z):</label>
                <div class="input-row">
                    <input type="number" id="transX" value="0" placeholder="X">
                    <input type="number" id="transY" value="0" placeholder="Y">
                    <input type="number" id="transZ" value="0" placeholder="Z">
                </div>
                <button onclick="applyTranslation()">–°–¥–≤–∏–Ω—É—Ç—å</button>
            </div>

            <hr>

            <button onclick="showProjections()" style="border-color: var(--accent);">üìä –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–µ–∫—Ü–∏–∏</button>
            <div style="height:10px;"></div>
            <button onclick="resetView()" style="background-color: var(--vertex-3d); border-color: var(--vertex-3d);">‚ôª –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>

            <hr>

            <label>–ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:</label>
            <textarea id="matrixOutput" readonly></textarea>
            <div style="height: 20px;"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="projModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–û—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ü–∏–∏</h2>
                <button class="close-btn" onclick="closeProjections()">‚úñ</button>
            </div>
            <div class="projections-grid">
                <div id="projXY" class="proj-plot"></div>
                <div id="projXZ" class="proj-plot"></div>
                <div id="projYZ" class="proj-plot"></div>
            </div>
        </div>
    </div>

    <script>
        // --- –î–ê–ù–ù–´–ï –ë–£–ö–í–´ "–ö" ---
        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—ã—Å—Ç—Ä–æ–µ–Ω—ã —Ç–∞–∫, —á—Ç–æ–±—ã –±—É–∫–≤–∞ —Å—Ç–æ—è–ª–∞ –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç–∏ Z
        const initialVertices = [
            // --- –ü–µ—Ä–µ–¥–Ω—è—è –≥—Ä–∞–Ω—å (Z=1) ---
            [0, 0, 1],   // 0: –ù–∏–∑ –ª–µ–≤–æ
            [1, 0, 1],   // 1: –ù–∏–∑ –æ—Ç—Å—Ç—É–ø
            [1, 2, 1],   // 2: –†–∞–∑–≤–∏–ª–∫–∞ –Ω–∏–∑
            [3, 0, 1],   // 3: –ù–æ–≥–∞ –Ω–∏–∑ (–≤–Ω—É—Ç—Ä)
            [4, 0, 1],   // 4: –ù–æ–≥–∞ –Ω–∏–∑ (–≤–Ω–µ—à)
            [2, 2.5, 1], // 5: –°–µ—Ä–µ–¥–∏–Ω–∞ (—Ç–∞–ª–∏—è)
            [4, 5, 1],   // 6: –ù–æ–≥–∞ –≤–µ—Ä—Ö (–≤–Ω–µ—à)
            [3, 5, 1],   // 7: –ù–æ–≥–∞ –≤–µ—Ä—Ö (–≤–Ω—É—Ç—Ä)
            [1, 3, 1],   // 8: –†–∞–∑–≤–∏–ª–∫–∞ –≤–µ—Ä—Ö
            [1, 5, 1],   // 9: –í–µ—Ä—Ö –æ—Ç—Å—Ç—É–ø
            [0, 5, 1],   // 10: –í–µ—Ä—Ö –ª–µ–≤–æ

            // --- –ó–∞–¥–Ω—è—è –≥—Ä–∞–Ω—å (Z=0) ---
            [0, 0, 0],   // 11
            [1, 0, 0],   // 12
            [1, 2, 0],   // 13
            [3, 0, 0],   // 14
            [4, 0, 0],   // 15
            [2, 2.5, 0], // 16
            [4, 5, 0],   // 17
            [3, 5, 0],   // 18
            [1, 3, 0],   // 19
            [1, 5, 0],   // 20
            [0, 5, 0]    // 21
        ];

        // –°–≤—è–∑–∏ (—Ä–µ–±—Ä–∞) –º–µ–∂–¥—É –≤–µ—Ä—à–∏–Ω–∞–º–∏ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ª–∏–Ω–∏–π
        const edges = [
            // –ü–µ—Ä–µ–¥–Ω–∏–π –∫–æ–Ω—Ç—É—Ä
            [0, 1], [1, 2], [2, 3], [3, 4], [4, 5], [5, 6], [6, 7], [7, 8], [8, 9], [9, 10], [10, 0],
            // –ó–∞–¥–Ω–∏–π –∫–æ–Ω—Ç—É—Ä
            [11, 12], [12, 13], [13, 14], [14, 15], [15, 16], [16, 17], [17, 18], [18, 19], [19, 20], [20, 21], [21, 11],
            // –°–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ (–≥–ª—É–±–∏–Ω–∞)
            [0, 11], [1, 12], [2, 13], [3, 14], [4, 15], [5, 16], [6, 17], [7, 18], [8, 19], [9, 20], [10, 21]
        ];

        // --- –õ–û–ì–ò–ö–ê ---
        let transformationMatrix = math.identity(4);

        // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å —É—á–µ—Ç–æ–º –º–∞—Ç—Ä–∏—Ü—ã
        function getTransformedVertices() {
            let verticesHomogeneous = initialVertices.map(v => [...v, 1]);
            let matrixT = math.transpose(transformationMatrix);
            let transformed = math.multiply(verticesHomogeneous, matrixT);
            let arr = transformed.toArray();
            return arr.map(v => [v[0], v[1], v[2]]);
        }

        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—É—é –º–∞—Ç—Ä–∏—Ü—É –∫ —Ç–µ–∫—É—â–µ–π
        function applyMatrix(newMatrix) {
            transformationMatrix = math.multiply(newMatrix, transformationMatrix);
            updateView();
        }

        // –í—Ä–∞—â–µ–Ω–∏–µ
        function applyRotation(axis) {
            let angleDeg = parseFloat(document.getElementById('rot' + axis.toUpperCase()).value);
            let angle = angleDeg * (Math.PI / 180);
            let M = math.identity(4).toArray();
            let c = Math.cos(angle), s = Math.sin(angle);

            if (axis === 'x') { M[1][1] = c; M[1][2] = -s; M[2][1] = s; M[2][2] = c; }
            else if (axis === 'y') { M[0][0] = c; M[0][2] = s; M[2][0] = -s; M[2][2] = c; }
            else { M[0][0] = c; M[0][1] = -s; M[1][0] = s; M[1][1] = c; }
            applyMatrix(M);
        }

        // –ú–∞—Å—à—Ç–∞–±
        function applyScale() {
            let s = parseFloat(document.getElementById('scaleVal').value);
            let M = math.identity(4).toArray();
            M[0][0] = s; M[1][1] = s; M[2][2] = s;
            applyMatrix(M);
        }

        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
        function applyTranslation() {
            let dx = parseFloat(document.getElementById('transX').value);
            let dy = parseFloat(document.getElementById('transY').value);
            let dz = parseFloat(document.getElementById('transZ').value);
            let M = math.identity(4).toArray();
            M[0][3] = dx; M[1][3] = dy; M[2][3] = dz;
            applyMatrix(M);
        }

        // –°–±—Ä–æ—Å
        function resetView() {
            transformationMatrix = math.identity(4);
            document.querySelectorAll('input').forEach(i => i.value = (i.id === 'scaleVal' ? 1 : 0));
            updateView();
        }

        // --- –û–¢–†–ò–°–û–í–ö–ê (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤) ---
        function updateView() {
            let currentVertices = getTransformedVertices();

            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–∏–Ω–∏–π (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å null –Ω—É–∂–µ–Ω –¥–ª—è —Ä–∞–∑—Ä—ã–≤–∞ –ª–∏–Ω–∏–∏ –≤ Plotly)
            let x = [], y = [], z = [];
            edges.forEach(e => {
                let p1 = currentVertices[e[0]], p2 = currentVertices[e[1]];
                x.push(p1[0], p2[0], null); y.push(p1[1], p2[1], null); z.push(p1[2], p2[2], null);
            });

            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–µ—Ä—à–∏–Ω (—Ç–æ—á–µ–∫)
            let vx = currentVertices.map(v => v[0]), vy = currentVertices.map(v => v[1]), vz = currentVertices.map(v => v[2]);

            // –í—ã–≤–æ–¥ –º–∞—Ç—Ä–∏—Ü—ã
            let mat = transformationMatrix.toArray ? transformationMatrix.toArray() : transformationMatrix;
            let matStr = mat.map(row => row.map(v => v.toFixed(2).padStart(7, ' ')).join('  ')).join('\n\n');
            document.getElementById('matrixOutput').value = matStr;

            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ 3D
            let layout = {
                paper_bgcolor: "#0B0C10", // –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –≤—Å–µ–≥–æ –±–ª–æ–∫–∞
                plot_bgcolor: "#0B0C10",  // –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –≥—Ä–∞—Ñ–∏–∫–∞
                margin: { l: 0, r: 0, t: 0, b: 0 },
                showlegend: false,
                scene: {
                    aspectmode: 'data',
                    xaxis: { title: 'X', color: '#66FCF1', gridcolor: '#1F2833', zerolinecolor: '#45A29E', backgroundcolor: "#0B0C10" },
                    yaxis: { title: 'Y', color: '#66FCF1', gridcolor: '#1F2833', zerolinecolor: '#45A29E', backgroundcolor: "#0B0C10" },
                    zaxis: { title: 'Z', color: '#66FCF1', gridcolor: '#1F2833', zerolinecolor: '#45A29E', backgroundcolor: "#0B0C10" },
                    camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } } // –ö–∞–º–µ—Ä–∞ —á—É—Ç—å –¥–∞–ª—å—à–µ
                }
            };

            Plotly.react('plot3d', [
                { type: 'scatter3d', mode: 'lines', x: x, y: y, z: z, line: { width: 6, color: '#66FCF1' }, opacity: 0.8 }, // –ù–µ–æ–Ω–æ–≤—ã–µ –ª–∏–Ω–∏–∏
                { type: 'scatter3d', mode: 'markers', x: vx, y: vy, z: vz, marker: { size: 5, color: '#FF0055', symbol: 'circle' } } // –†–æ–∑–æ–≤—ã–µ –≤–µ—Ä—à–∏–Ω—ã
            ], layout);
        }

        // --- –ü–†–û–ï–ö–¶–ò–ò ---
        function showProjections() {
            document.getElementById('projModal').style.display = 'flex';
            let verts = getTransformedVertices();

            // –¶–≤–µ—Ç–∞ –¥–ª—è 2D –≥—Ä–∞—Ñ–∏–∫–æ–≤
            const layout2d = (title, ax1, ax2) => ({
                title: { text: title, font: { color: '#66FCF1' } },
                paper_bgcolor: "#1F2833",
                plot_bgcolor: "#0B0C10",
                margin: { l: 40, r: 10, t: 40, b: 40 },
                xaxis: { title: ax1, color: '#C5C6C7', gridcolor: '#2C3E50' },
                yaxis: { title: ax2, color: '#C5C6C7', gridcolor: '#2C3E50' }
            });

            const plot2d = (div, i1, i2, title, ax1, ax2) => {
                let x = [], y = [];
                edges.forEach(e => {
                    x.push(verts[e[0]][i1], verts[e[1]][i1], null);
                    y.push(verts[e[0]][i2], verts[e[1]][i2], null);
                });
                Plotly.newPlot(div, [
                    { type: 'scatter', mode: 'lines', x: x, y: y, line: { color: '#66FCF1', width: 2 } },
                    { type: 'scatter', mode: 'markers', x: verts.map(v => v[i1]), y: verts.map(v => v[i2]), marker: { color: '#FF0055', size: 6 } }
                ], layout2d(title, ax1, ax2));
            };

            plot2d('projXY', 0, 1, 'Oxy (–í–∏–¥ —Å–≤–µ—Ä—Ö—É)', 'X', 'Y');
            plot2d('projXZ', 0, 2, 'Oxz (–í–∏–¥ —Å–ø–µ—Ä–µ–¥–∏)', 'X', 'Z');
            plot2d('projYZ', 1, 2, 'Oyz (–í–∏–¥ —Å–±–æ–∫—É)', 'Y', 'Z');
        }

        function closeProjections() { document.getElementById('projModal').style.display = 'none'; }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateView();
        window.onresize = () => Plotly.Plots.resize('plot3d');

    </script>
</body>
</html>
